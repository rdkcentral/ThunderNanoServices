
set(CMAKE_MODULE_PATH "${CMAKE_SOURCE_DIR}/cmake")

find_package(BcmNxServer QUIET)
if (LIBNXSERVER_FOUND)

    list(APPEND PLUGIN_DEPENDENCIES_INCLUDE_DIRS ${LIBNXCLIENT_INCLUDE_DIRS})
    list(APPEND PLUGIN_DEPENDENCIES ${LIBNEXUS_LIBRARY} ${LIBNXCLIENT_LIBRARY})
    list(APPEND PLUGIN_SOURCES "${CMAKE_CURRENT_SOURCE_DIR}/NexusCapture.cpp")

    set(PLUGIN_DEFINITIONS
            "BSTD_CPU_ENDIAN=BSTD_ENDIAN_LITTLE"
            PARENT_SCOPE)

else (LIBNXSERVER_FOUND)

find_package(BCMHost QUIET)

if (BCM_HOST_FOUND)

    set(PLUGIN_DEFINITIONS
            USE_VCHIQ_ARM=1
            OMX_SKIP64BIT
            RPI_NO_X
            PARENT_SCOPE)

    list(APPEND PLUGIN_DEPENDENCIES_INCLUDE_DIRS ${BCM_HOST_INCLUDE_DIRS})
    list(APPEND PLUGIN_DEPENDENCIES ${BCM_HOST_LIBRARIES} -lopenmaxil)
    list(APPEND PLUGIN_SOURCES "${CMAKE_CURRENT_SOURCE_DIR}/Dispmanx.cpp")

else (BCM_HOST_FOUND)
message(FATAL_ERROR "There is no graphic backend for Snapshot plugin")
endif (BCM_HOST_FOUND)

endif (LIBNXSERVER_FOUND)

# pass the updated lists to parent CMake file
set(PLUGIN_DEPENDENCIES_INCLUDE_DIRS "${PLUGIN_DEPENDENCIES_INCLUDE_DIRS}" PARENT_SCOPE)
set(PLUGIN_DEPENDENCIES "${PLUGIN_DEPENDENCIES}" PARENT_SCOPE)
set(PLUGIN_SOURCES "${PLUGIN_SOURCES}" PARENT_SCOPE)
